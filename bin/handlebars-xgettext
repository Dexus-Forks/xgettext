#!/usr/bin/env node

var parse = require('..'),
  colors = require('colors');

var argv = require('optimist')
  .usage([
    'Extract strings from Handlebars source',
    '',
    'handlebars-xgettext [OPTION] [INPUTFILE]...'
  ].join('\n'))
  .alias({
    'k': 'keyword',
    'o': 'output'
  })
  .describe({
    'directory': 'add directory to list for input files search',
    'output': 'write output to specified file',
    'from-code': 'encoding of input files',
    'keyword': 'additional keyword to be looked for'
  })
  .default({
    'from-code': 'ascii',
    'keyword': ['gettext', '_']
  })
  .check(function (argv) {
    argv['from-code'] = argv['from-code'].toLowerCase().replace(/\W/g, '');
    if (['utf8', 'ascii', 'base64'].indexOf(argv['from-code']) < 0) {
      throw 'Encoding of input files must be either utf8, ascii or base64.'.red;
    }
    if (!argv._ && !argv['files-from'] && !argv.directory) {
      throw 'No input specified.'.red;
    }
  })
  .argv;

input = argv._;
delete argv._;

parse(input, argv, function (po) {
  if (!argv.output) {
    process.stdout.write(po);
  }
});
